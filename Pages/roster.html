<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="../css/style.css?v=2">

<style>
/* ==== ROSTER PAGE STYLES ===== */

.roster-container {
    width: 95%;
    max-width: 1600px;
    margin: 240px auto 80px auto;
    font-family: "Segoe UI", Arial, sans-serif;
}

/* CATEGORY HEADERS */
.roster-category {
    font-size: 30px;
    font-weight: 800;
    margin-top: 40px;
    color: #0F2037;
    border-bottom: 3px solid #FFC300;
    padding-bottom: 8px;
}

/* TABLE */
.roster-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    background: #0F2037;
    color: white;
    border-radius: 8px;
    overflow: hidden;
}

/* HEADER CELLS */
.roster-table th {
    background: #1b2f4a;
    padding: 12px;
    text-align: left;
    font-size: 16px;
    border-bottom: 2px solid #324a63;
}

/* DATA CELLS */
.roster-table td {
    padding: 10px;
    font-size: 15px;
    border-bottom: 1px solid #21334d;
}

/* ODD ROW STRIPING */
.roster-table tr:nth-child(odd) td {
    background: #122235;
}

/* Rank Insignia */
.insignia {
    width: 40px;
    height: 40px;
    border-radius: 4px;
    object-fit: contain;
    background: #273850;
}

/* Make tables responsive */
@media (max-width: 800px) {
    .roster-table th:nth-child(3),
    .roster-table td:nth-child(3) {
        display: none;
    }
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="top-light"></div>
<div class="top-dark"></div>

<a href="../index.html">
    <img src="../assets/fhp-logo.png" class="fhp-logo">
</a>

<div class="nav-row">
    <div class="about-container">
        <a href="#" class="nav-link">ABOUT FHP</a>
        <div class="dropdown-menu">
            <a href="policy-manual.html">Policy Manual</a>
            <a href="uniform-structure.html">Uniform Structure</a>
            <a href="fleet.html">Fleet</a>
            <a href="training-academy.html">Training Academy</a>
            <a href="staff.html">Staff</a>
        </div>
    </div>

    <a href="faq.html" class="nav-link">FAQ</a>
    <a href="fhp-aux.html" class="nav-link">FHP AUXILIARY</a>
    <a href="roster.html" class="nav-link">ROSTER</a>
</div>

<div class="director-name">Alex Lucas, Executive Director</div>

<div class="apply-wrapper">
    <div class="nav-divider"></div>
    <img src="../assets/applynow.png" class="apply-btn">
</div>

<div class="subnav-row">
    <a href="why-apply.html">WHY APPLY?</a>
    <a href="requirements.html">REQUIREMENTS</a>
    <a href="career-opportunities.html">CAREER OPPORTUNITIES</a>
    <a href="faq.html" class="nav-link">FAQ</a>
</div>

<!-- MAIN CONTENT -->
<div class="roster-container" id="roster"></div>

<!-- ========================= -->
<!-- GOOGLE SHEETS ROSTER LOGIC -->
<!-- ========================= -->
<script>
async function loadRoster() {

    const url =
    "https://docs.google.com/spreadsheets/d/15AgzaaRt5SLCk1gPHoB8lybfa4YW0bZD3BiKnXzNPfE/gviz/tq?gid=1051466178&tqx=out:json";

    const response = await fetch(url);
    const text = await response.text();

    // Extract pure JSON from GViz wrapper
    const json = JSON.parse(
        text.substring(text.indexOf("{"), text.lastIndexOf("}") + 1)
    );

    const rows = json.table.rows;

    // FIXED COLUMN INDEXES (from your JSON)
    const COL = {
        identifier: 3,
        name: 4,
        rank: 6,
        insignia: 7,
        phone: 9,
        status: 10,
        hours1: 11,
        activity: 12,
        hours2: 13,
        doh: 14,
        category: 15
    };

    // Category assignment based on identifier ranges
    function categorize(id) {
        id = parseInt(id);

        if (id >= 2201 && id <= 2203) return "Troop Headquarters";
        if (id >= 2204 && id <= 2208) return "District Command Staff";
        if (id >= 2209 && id <= 2224) return "District Supervisors";
        if (id >= 2225 && id <= 2235) return "Investigators";
        if (id >= 2236 && id <= 2355) return "DAVIE & MIAMI DADE DISTRICT";
        if (id >= 2501 && id <= 2599) return "Auxiliary Patrol";

        return "Unassigned";
    }

    // Parse each row
    let data = rows.map(r => {
        const c = r.c;

        const id = c[COL.identifier]?.f || c[COL.identifier]?.v || "";

        return {
            identifier: id,
            name:       c[COL.name]?.v || "",
            rank:       c[COL.rank]?.v || "",
            insignia:   c[COL.insignia]?.v || "",
            phone:      c[COL.phone]?.v || "",
            status:     c[COL.status]?.v || "",
            hours1:     c[COL.hours1]?.f || c[COL.hours1]?.v || "",
            activity:   c[COL.activity]?.v || "",
            hours2:     c[COL.hours2]?.f || c[COL.hours2]?.v || "",
            doh:        c[COL.doh]?.f || c[COL.doh]?.v || "",
            category:   categorize(id)
        };
    });

    // Remove blank names
    data = data.filter(r => r.name.trim() !== "");

    // Sort numerically by callsign/identifier
    data.sort((a,b) => parseInt(a.identifier) - parseInt(b.identifier));

    // Rank â†’ Insignia mapping
    const RANK_MAP = {
        "Colonel": "Colonel.png",
        "Major": "Major.png",
        "Captain": "Captain.png",
        "Lieutenant": "Lieutenant.png",
        "Master Sergeant": "MasterSergeant.png",
        "Sergeant First Class": "SergeantFirstClass.png",
        "Staff Sergeant": "StaffSergeant.png",
        "Sergeant": "Sergeant.png",
        "Master Corporal": "MasterCorporal.png",
        "Senior Corporal": "SeniorCorporal.png",
        "Corporal": "Corporal.png",
        "Master Trooper": "MasterTrooper.png",
        "Senior Trooper": "SeniorTrooper.png",
        "Trooper First Class": "TrooperFirstClass.png",
        "Trooper Specialist": "TrooperSpecialist.png",
        "Trooper": "Trooper.png",
        "Probationary Trooper": "ProbationaryTrooper.png",
        "Auxiliary Sergeant": "AuxiliarySergeant.png",
        "Auxiliary Trooper": "AuxiliaryTrooper.png"
    };

    function resolveInsignia(rank) {
        return RANK_MAP[rank] || "default.png";
    }

    // Category order
    const categories = [
        "Troop Headquarters",
        "District Command Staff",
        "District Supervisors",
        "Investigators",
        "DAVIE & MIAMI DADE DISTRICT",
        "Auxiliary Patrol"
    ];

    let html = "";

    categories.forEach(cat => {
        const section = data.filter(r => r.category === cat);

        if (section.length === 0) return;

        html += `
            <div class="roster-category">${cat}</div>
            <table class="roster-table">
                <tr>
                    <th>Identifier</th>
                    <th>Name</th>
                    <th>Insignia</th>
                    <th>Rank</th>
                    <th>Phone</th>
                    <th>Status</th>
                    <th>Hours</th>
                    <th>Activity</th>
                    <th>Date of Hire</th>
                </tr>
        `;

        section.forEach(r => {
            const file = resolveInsignia(r.rank);

            html += `
                <tr>
                    <td>${r.identifier}</td>
                    <td>${r.name}</td>
                    <td><img class="insignia"
                        src="../assets/ranks/${file}"
                        onerror="this.src='../assets/ranks/default.png'"></td>
                    <td>${r.rank}</td>
                    <td>${r.phone}</td>
                    <td>${r.status}</td>
                    <td>${r.hours1}</td>
                    <td>${r.activity}</td>
                    <td>${r.doh}</td>
                </tr>
            `;
        });

        html += `</table>`;
    });

    document.getElementById("roster").innerHTML = html;
}

loadRoster();
</script>

</body>
</html>
