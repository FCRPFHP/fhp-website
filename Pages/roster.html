<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="../css/style.css?v=2">

<style>
/* ==== ROSTER PAGE STYLES ===== */

.roster-container {
    width: 95%;
    max-width: 1600px;
    margin: 240px auto 80px auto;
    font-family: "Segoe UI", Arial, sans-serif;
}

/* CATEGORY HEADERS */
.roster-category {
    font-size: 30px;
    font-weight: 800;
    margin-top: 40px;
    color: #0F2037;
    border-bottom: 3px solid #FFC300;
    padding-bottom: 8px;
}

/* TABLE */
.roster-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    background: #0F2037;
    color: white;
    border-radius: 8px;
    overflow: hidden;
}

/* HEADER CELLS */
.roster-table th {
    background: #1b2f4a;
    padding: 12px;
    text-align: left;
    font-size: 16px;
    border-bottom: 2px solid #324a63;
}

/* DATA CELLS */
.roster-table td {
    padding: 10px;
    font-size: 15px;
    border-bottom: 1px solid #21334d;
}

/* ODD ROW STRIPING */
.roster-table tr:nth-child(odd) td {
    background: #122235;
}

/* Rank Insignia Placeholder */
.insignia {
    width: 40px;
    height: 40px;
    background-color: #273850;
    border-radius: 4px;
    display: inline-block;
}

/* Make tables responsive */
@media (max-width: 800px) {
    .roster-table th:nth-child(3),
    .roster-table td:nth-child(3) {
        display: none; /* hide insignias on small screens */
    }
}
</style>
</head>

<body>

<!-- HEADER (unchanged) -->
<div class="top-light"></div>
<div class="top-dark"></div>

<a href="../index.html">
    <img src="../assets/fhp-logo.png" class="fhp-logo">
</a>

<div class="nav-row">
    <div class="about-container">
        <a href="#" class="nav-link">ABOUT FHP</a>
        <div class="dropdown-menu">
            <a href="policy-manual.html">Policy Manual</a>
            <a href="uniform-structure.html">Uniform Structure</a>
            <a href="fleet.html">Fleet</a>
            <a href="training-academy.html">Training Academy</a>
            <a href="staff.html">Staff</a>
        </div>
    </div>

    <a href="faq.html" class="nav-link">FAQ</a>
    <a href="fhp-aux.html" class="nav-link">FHP AUXILIARY</a>
    <a href="roster.html" class="nav-link">ROSTER</a>
</div>

<div class="director-name">Alex Lucas, Executive Director</div>

<div class="apply-wrapper">
    <div class="nav-divider"></div>
    <img src="../assets/applynow.png" class="apply-btn">
</div>

<div class="subnav-row">
    <a href="why-apply.html">WHY APPLY?</a>
    <a href="requirements.html">REQUIREMENTS</a>
    <a href="career-opportunities.html">CAREER OPPORTUNITIES</a>
    <a href="faq.html" class="nav-link">FAQ</a>
</div>

<!-- MAIN CONTENT -->
<div class="roster-container" id="roster"></div>


<!-- ========================== -->
<!-- GOOGLE SHEETS ROSTER LOGIC -->
<!-- ========================== -->
<script>
async function loadRoster() {

    const url =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vRRxO7G0XO1SVjwMnoz4UK9C3ODmUpIgGfyO_RqxDqseiBseVMePhe6DhIH7sVoaOT010jnkiDXJsez/pub?gid=1051466178&single=true&output=csv";

    const response = await fetch(url);
    const csvText = await response.text();

    const lines = csvText.split(/\r?\n/).filter(l => l.trim() !== "");

    // CSV PARSER HANDLING QUOTES
    function parseCSVLine(line) {
        const result = [];
        let val = "";
        let inQuotes = false;

        for (let i = 0; i < line.length; i++) {
            const c = line[i];
            if (c === '"' && line[i+1] === '"') {
                val += '"'; i++;
            } else if (c === '"') {
                inQuotes = !inQuotes;
            } else if (c === ',' && !inQuotes) {
                result.push(val.trim()); val = "";
            } else {
                val += c;
            }
        }
        result.push(val.trim());
        return result;
    }

    const rows = lines.map(parseCSVLine);
    const header = rows[0];

    // DYNAMIC INDEX LOOKUP
    const COL = {
        identifier: header.indexOf("Identifier"),
        name: header.indexOf("Name"),
        rank: header.indexOf("Rank"),
        insignia: header.indexOf("Insignia"),
        phone: header.indexOf("Phone Number"),
        status: header.indexOf("Status"),
        hours1: header.indexOf("Hours"),
        activity: header.indexOf("Activity Status"),
        hours2: header.indexOf("Hours", header.indexOf("Hours") + 1),
        doh: header.indexOf("DOH"),
        category: header.indexOf("Category")
    };

    // Convert rows â†’ objects
    let data = rows.slice(1).map(r => ({
        identifier: r[COL.identifier] || "",
        name: r[COL.name] || "",
        rank: r[COL.rank] || "",
        insignia: r[COL.insignia] || "",
        phone: r[COL.phone] || "",
        status: r[COL.status] || "",
        hours1: r[COL.hours1] || "",
        activity: r[COL.activity] || "",
        hours2: r[COL.hours2] || "",
        doh: r[COL.doh] || "",
        category: r[COL.category] || ""
    }));

    // Remove rows without names
    data = data.filter(r => r.name.trim() !== "");

    // Sort by Identifier (your Callsign)
    data.sort((a,b) => parseInt(a.identifier) - parseInt(b.identifier));

    // Rank Image Map
    const RANK_MAP = {
        "Colonel": "Colonel.png",
        "Major": "Major.png",
        "Captain": "Captain.png",
        "Lieutenant": "Lieutenant.png",
        "Master Sergeant": "MasterSergeant.png",
        "Sergeant First Class": "SergeantFirstClass.png",
        "Staff Sergeant": "StaffSergeant.png",
        "Sergeant": "Sergeant.png",
        "Master Corporal": "MasterCorporal.png",
        "Senior Corporal": "SeniorCorporal.png",
        "Corporal": "Corporal.png",
        "Master Trooper": "MasterTrooper.png",
        "Senior Trooper": "SeniorTrooper.png",
        "Trooper First Class": "TrooperFirstClass.png",
        "Trooper Specialist": "TrooperSpecialist.png",
        "Trooper": "Trooper.png",
        "Probationary Trooper": "ProbationaryTrooper.png",
        "Auxiliary Sergeant": "AuxiliarySergeant.png",
        "Auxiliary Trooper": "AuxiliaryTrooper.png"
    };

    function resolveInsignia(rank) {
        return RANK_MAP[rank] || "default.png";
    }

    const categories = [
        "Troop Headquarters",
        "District Command Staff",
        "District Supervisors",
        "Investigators",
        "DAVIE & MIAMI DADE DISTRICT",
        "Auxiliary Patrol"
    ];

    let html = "";

    categories.forEach(cat => {

        const section = data.filter(
            r => r.category.toLowerCase() === cat.toLowerCase()
        );

        if (section.length === 0) return;

        html += `
            <div class="roster-category">${cat}</div>
            <table class="roster-table">
                <tr>
                    <th>Identifier</th>
                    <th>Name</th>
                    <th>Insignia</th>
                    <th>Rank</th>
                    <th>Phone</th>
                    <th>Status</th>
                    <th>Hours</th>
                    <th>Activity</th>
                    <th>Hours 2</th>
                    <th>Date of Hire</th>
                </tr>
        `;

        section.forEach(r => {
            const file = resolveInsignia(r.rank);

            html += `
                <tr>
                    <td>${r.identifier}</td>
                    <td>${r.name}</td>
                    <td><img class="insignia"
                        src="../assets/ranks/${file}"
                        onerror="this.src='../assets/ranks/default.png'"></td>
                    <td>${r.rank}</td>
                    <td>${r.phone}</td>
                    <td>${r.status}</td>
                    <td>${r.hours1}</td>
                    <td>${r.activity}</td>
                    <td>${r.hours2}</td>
                    <td>${r.doh}</td>
                </tr>
            `;
        });

        html += `</table>`;
    });

    document.getElementById("roster").innerHTML = html;
}

loadRoster();
</script>



</body>
</html>
